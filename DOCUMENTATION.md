## Documentation

**NOTE:** The word "client" in this file refers to the person who will be making use of this bot, which will most likely be a University of Portsmouth staff member. The word "user" or "users" refers to the users or students in a Discord server. The word "client-side" will be used to refer to the actual client-side in a software context.

### This documentation will break down all the main files and folders that can be found in this repository.

### discordServer.js (Discord server file)

| Function Name                     | Function Argument(s)                                                                                          | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| :-------------------------------- | :------------------------------------------------------------------------------------------------------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| changeCSVValues                   | One argument - an array of 5 OR 6 values                                                                      | The purpose of this function is to allow the client to customize their CSV file column numbers any way they want. If the client has the first name of students as the 1st column in their CSV file, they would input 1 for that value, and so on, and these values will be taken as an argument by this function and the "csvValues" object will be changed accordingly. This function receives an array of 5 or 6 values which will be received from the client-side. When the client submits their values, a POST request is made to a specific endpoint called "csvCustomizer" setup in the server, which will then invoke this function. This function takes the array of values and uses it to change the values of an object called "csvValues". The bot then uses the csvValues later on in the code when verifying the user/student.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| changeAbbreviations               | One argument - an array of 9 values                                                                           | The purpose of this function is to allow the client to customize any abbreviations they may or may not be using in their CSV file "course name" column. For example, the clients CSV file may choose to use "CS" as an abbreviation for "Computer Science", and this function allows the client to input those abbreviations so the bot can be made aware of it. This function receives an array of 9 values which will be received from the client-side. When the client submits their values, a POST request is made to a specific endpoint called "abbreviations" setup in the server, which will then invoke this function. When this function is invoked, a boolean variable called "abbreviationsMode" will be set to true, indicating that the bot now needs to handle abbreviations when dealing with the CSV file provided by the client. The array of values provided as an argument is then taken and used to change the values of each abbreviation stored in an object called "abbreviations" accordingly based on the clients input.                                                                                                                                                                                                                                                                                                  |
| changeCustomSecurityQuestion      | One argument - a variable containing the text of the security question                                        | This function takes the argument containing the security question input by the client and sets the value of a variable called "customSecurityQuestion" to the security question provided as an argument. The bot will then use this security question later on in the code if needed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| changeInitialCSV                  | Zero arguments                                                                                                | This function changes a boolean variable called "initialCSV" from false to true. This function is only invoked when the client inputs a CSV file containing verification information to verify new users/students. If the client has not input any CSV file, the "initialCSV" boolean will remain false and the bot will not attempt to verify any students until the boolean value is true.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| clearOutResults                   | Zero arguments                                                                                                | This function clears out the results array which contains the contents of the verification CSV file input by the client. This function is only invoked when the client inputs another verification CSV file after already inputting an initial one, so the results array must be cleared.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| clearOutProgressResults           | Zero arguments                                                                                                | This function clears out the progress results array which contains the contents of the progress decisions CSV file input by the client. This function is only invoked when the client inputs another progress decisions CSV file after already inputting an initial one, so the progress results array must be cleared.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| initialCSVLoader                  | One argument - a variable containing the path of the verification CSV file                                    | This function takes the path of the CSV file as an argument and then parses it using a third party npm package called csv-parser. The CSV file is parsed in such a way that each row in the CSV is turned into an object and added to an array, so the end result is an array of objects with each object representing one row in the CSV file. Since it is assumed the CSV file input by the client will have at least 5 rows including first name, last name, student number, level and course name, each object in the array will have a first name, last name, student number, level, and course name, representing one student in the CSV file. If the client chooses to add a security question column in their CSV, each object will have that too.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| botListeningEvents                | Zero arguments                                                                                                | This function contains all the main logic/functionality of the bot. The function starts out by listening for an event called "guildMemberAdd" that indicates a new user has joined the Discord server, and when that event is fired, the bot will DM the user asking them to verify themself. The function also has an event listener for the "messageCreate" which is fired when a user sends the bot a message (I set it up to only work in DMs, so user must DM the bot), once the user sends the bot a DM containing their verification info, the users message is broken down into an array and that array is compared to the CSV file input by the client to check if there is a match or not. If a match is found, their Discord nickname and role will be changed accordingly using the "nameAndRoleChanger" function which is explained below. **Please note, this function is extremely long with hundreds of lines of code as it contains all the main functionality and logic of the bot, so it is quite hard to document all its specifics here. However, the source code is well documented with comments and all variables/functions have been named appropriately so it should be quite easy to understand once you read the code.**                                                                                                |
| securityMode                      | Zero arguments                                                                                                | This function simply turns security mode on or off by toggling a boolean value called "securityQuestion". When the client toggles security mode on/off using the Discord bot dashboard provided to them, a GET request is made to a specific endpoint called "security" setup in the server which then invokes this function.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| getLastKnownStatus                | Zero arguments                                                                                                | Whenever the homepage is loaded, a GET request is made to a specific endpoint called "lastStatus" setup in the server which invokes this "getLastKnownStatus" function. This function then returns the last known status of security mode (on/off) so that the proper last known status can be sent back to the client-side to be rendered on the home page for the client to see. This comes in handy when the client turns security mode on, then refreshes the page, or closes the page and reopens it, then the GET request is made and the last known status of security mode is fetched and sent to the client-side for the client to see.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| toggleLastKnownStatus             | Zero arguments                                                                                                | This function toggles the last known status of security mode on or off by changing a boolean variable called "lastKnownSecurityStatus" to true or false. Whenever the client toggles security mode on or off, a PATCH request is sent to a specific endpoint called "lastStatus" setup in the server which then invokes this function to run. This makes sure whenever the client-side value of security mode changes, the server-side value changes as well. Then when the home page is reloaded, the value from the server-side is sent to the client using the "getLastKnownStatus" function explained above.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| getLastKnownAbbreviationStatus    | Zero arguments                                                                                                | Whenever the abbreviations page is loaded, a GET request is made to a specific endpoint called "lastAbbreviationStatus" setup in the server which invokes this "getLastKnownAbbreviationStatus" function. This function then returns the last known status of abbreviations mode (on/off) so that the proper last known status can be sent back to the client-side to be rendered on the abbreviations page for the client to see. This comes in handy when the client turns abbreviations mode on, then refreshes the page, or closes the page and reopens it, then the GET request is made and the last known status of abbreviations mode is fetched and sent to the client-side for the client to see.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| toggleLastKnownAbbreviationStatus | Zero arguments                                                                                                | This function toggles the last known status of abbreviations mode on or off by changing a boolean variable called "lastKnownAbbreviationStatus" to true or false. Whenever the client toggles abbreviations mode on or off, a PATCH request is sent to a specific endpoint called "lastAbbreviationStatus" setup in the server which then invokes this function to run. This makes sure whenever the client-side value of abbreviation mode changes, the server-side value changes as well. Then when the abbreviations page is reloaded, the value from the server-side is sent to the client using the "getLastKnownAbbreviationStatus" function explained above.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| nameAndRoleChanger                | Zero arguments                                                                                                | This function is a helper function used to change the Discord nickname and role of a user once they have been verified. This is done by breaking down the users message array (the message they sent the bot upon verification) and splicing the array to get their first name, first letter of their last name, as well as their UP number. Their role is then calculated based on the level they provided as well as the course name they provided the bot upon verification. For example, if a user typed "Joe Briggs UP123456 L4 Computer Science", the end result would look like "Joe B / up123456" and the role they would be given would be L4NONSE. This is because all roles that are not Software Engineering fall under the "NONSE" category, as per the rules of the UoP server. This function makes sure to change any value that is not Software Engineering into "NONSE" before assigning any role.                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| helperRoleUpdate                  | Three arguments - The guild member whos roles need to be edited, the role ID to remove, and the roleID to add | This is a helper function that is used in the botCSVUpdater function (which is explained below) which takes 3 arguments, a member, a role ID to remove, and a role ID to add. The function just simply removes the role ID that needs to be removed, adds the one that needs to be added, and that's it. This function was created to avoid repeating the same two lines multiple times in the botCSVUpdater function.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| botCSVUpdater                     | One argument - a variable containing the path of the progress decisions CSV file -                            | This function is used to update all the users roles using a progress decision CSV file input by the client. When the client inputs the progress decisions CSV file, a POST request is made to a specific endpoint called "csvFile" setup in the server which then invokes this function. This function then takes the CSV file and parses it in the same way as the initialCSVLoader function parsed the verification CSV file. The end result is an array of objects with each object representing one row of the progress decisions CSV file, and each object in this case will have a UP number (to identify the student) and a progress decision (PROGRESS/REPEAT). The function then loops through every member in the server and uses their nickname to find a match between the UP number in their nickname to a UP number in the CSV file. If a match is found, the progress decision is looked at, and if it is a "PROGRESS", the users role is updated accordingly using a switch statement that updates each role accordingly based on level and course name. It is assumed that every user in the server will have been previously verified either manually or by the bot, meaning that every user in the server should have a UP number in their nickname assuming they are a student, and this function makes use of those nicknames. |

### expressServer.js (Express server file)

| Method | Route                   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| :----- | :---------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| GET    | /                       | This is the main page/homepage. The index.html page is sent by this route.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| GET    | /security               | Toggles security mode on/off.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| GET    | /lastStatus             | Returns a boolean variable indicating whether or not security mode was last turned on or off.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| GET    | /lastAbbreviationStatus | Returns a boolean variable indicating whether or not abbreviations mode was last turned on or off.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| PATCH  | /lastStatus             | Toggles the value of the boolean variable which indicates whether or not security mode is on or off.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| PATCH  | /lastAbbreviationStatus | Toggles the value of the boolean variable which indicates whether or not abbreviations mode is on or off.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| POST   | /csvCustomizer          | Changes the values of the CSV columns (which are stored in an object in the discordServer.js file) to the values provided by the client. This allows for full CSV customization when it comes to the order of the columns. For example, if the clients CSV file has first name as the 3rd column, the number 3 would be input as a value for that column, and so on.                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| POST   | /abbreviations          | Changes the values of the abbreviations (which are stored in an object in the discordServer.js file) to the values provided by the client. This allows for full CSV customization when it comes to any abbreviations used in the clients CSV file, specifically in the "course name" column. For example, CSV file might have "CS" as an abbreviation for "Computer Science".                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| POST   | /securityQuestion       | Changes the value of the security question to whatever the client input. This allows the client to customize the security question they would like the bot to ask each student upon verification.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| POST   | /initialCSV             | This endpoint is used whenever the client inputs a verification CSV file. If it is the first time the client has input a file, a boolean variable is toggled to true to indicate that the bot has now been fed a CSV file and can now start verifying students. If there was already a previous CSV file input by the client, the results array which would contain the data from the previous CSV file will be cleared out using the "clearOutResults" function, and the directory containing the previous CSV file will be cleared out as well using the "deleteCSVFiles" function, and finally, the CSV file will then be saved to a specific path and the "initialCSVLoader" function will run to parse the new CSV file and allow the bot to start using the new file to verify students.                                      |
| POST   | /csvFile                | This endpoint is used whenever the client inputs a progress decisions CSV file. If it is the first time the client has input a file, a boolean variable is toggled to true to indicate that the bot has now been fed a progress decisions CSV file. If there was already a previous CSV file input by the client, the progress results array which would contain the data from the previous CSV file will be cleared out using the "clearOutProgressResults" function, and the directory containing the previous CSV file will be cleared out as well using the "deleteCSVFiles" function, and finally, the CSV file will then be saved to a specific path and the "botCSVUpdater" function will run so that the bot can use the new CSV file to update all the students roles based on the progress decisions of the new CSV file. |

### expressHelpers.js (File with helper functions for the Express server)

| Function Name  | Function Argument(s)                                                                                                            | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| :------------- | :------------------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| deleteCSVFiles | One argument - a variable containing the path of a directory                                                                    | This function was created as a helper function to be used in the expressServer.js file. This function simply deletes all files located in a certain directory using the fs module. This function is used whenever the client inputs a CSV file, and then decides to input another one later, this makes sure the first one gets deleted before the second one is saved to the directory. This just avoids cluttering the directory with random files and wasting valuable storage space.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| createCSVFile  | Five arguments - a path to save the file, the request body, the response, a success message, and a function to run upon success | This function was created as a helper function to be used in the expressServer.js file. The purpose of this function is to save the CSV file that the client inputs to a directory that can then be used server-side when needed. This function was made very generic so it can be used in multiple scenarios. The first one being when the client inputs a **verification** CSV file, and the second one being whne the client inputs a **progress decisions** CSV file. When the client inputs a verification CSV file, a POST request is made to the "initialCSV" endpoint in the server which then runs this function and provides it with all 4 arguments including a specific path to save the verification file in as well as a function called "initialCSVLoader" which loads the verification CSV file and parses it using csv-parser (this "initialCSVLoader" function was explained in greater detail above) to run upon successfully saving the file. The same thing happens when the client inputs a progress decisions CSV file except the POST request is sent to another endpoint called "csvFile" and a different path is given for the progress decisions CSV file to be saved, as well as a different function to be run when the file is successfully saved. The function to be run in this instance would be the "botCSVUpdater" which updates roles based on progress decisions (this "botCSVUpdater" function was explained in greater detail above). To be clear, the request body contains the contents of the CSV file that must be taken and saved using the fs module (which is what this createCSVFile function does), this is why the request body must be passed as well. |

### public, csvTestFiles, initialCSV, progressCSV (Folders)

**public** - This folder contains all the HTML/CSS/JS files for the two pages of the Discord bot dashboard created with Node & Express. The two pages are the homepage and the abbreviations page.

**csvTestFiles** - This folder stores many CSV files containing dummy data that can be used when testing the verification feature of the bot. Note that each CSV file has a different order in terms of the columns, and this was used to make sure the functionality of customizing the CSV in any order the client wants works perfectly. There is also a progress decisions CSV file that can be used when testing the updating roles based on progress decisions feature.

**initialCSV** - This folder is where the verification CSV files input by the client are saved to. This folder is cleared out every time a new verification CSV file is input by the client.

**progressCSV** - This folder is where the progress decisions CSV files input by the client are saved to. This folder is cleared out every time a new progress decisions CSV file is input by the client.
